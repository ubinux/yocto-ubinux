From f623f7978373f1fe63c2e43652271f1b3ef48502 Mon Sep 17 00:00:00 2001
From: Wang Mingyu <wangmy@cn.fujitsu.com>
Date: Fri, 5 Nov 2021 17:04:58 +0900
Subject: [PATCH] The rpm has been updated, and the name of the database has 
 changed from Pakages to rpmdb.sqlite

Signed-off-by: Wang Mingyu <wangmy@cn.fujitsu.com>
---
 dnf-plugins/tui.py | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/dnf-plugins/tui.py b/dnf-plugins/tui.py
index 1a0fdc0..2137e98 100755
--- a/dnf-plugins/tui.py
+++ b/dnf-plugins/tui.py
@@ -211,7 +211,7 @@ class TuiCommand(commands.Command):
                     tar = False
                     old_md5 = None
 
-                    rpm_dbfile = self.opts.installroot + "/var/lib/rpm/Packages"
+                    rpm_dbfile = self.opts.installroot + "/var/lib/rpm/rpmdb.sqlite"
                     if os.path.exists(rpm_dbfile):
                         f1 = open(rpm_dbfile, 'rb')
                         old_md5 = hashlib.md5(f1.read()).hexdigest()
@@ -227,6 +227,8 @@ class TuiCommand(commands.Command):
                     if old_md5:
                         f2 = open(rpm_dbfile, 'rb')
                         new_md5 = hashlib.md5(f2.read()).hexdigest()
+                        #old_md5 and new_md5 is compared to determine whether the RPM source has changed,
+                        #so as to determine whether rootfs needs to be packaged
                         if old_md5 != new_md5:
                             tar = True
                     elif os.path.exists(rpm_dbfile):
-- 
2.25.1

